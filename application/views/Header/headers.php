<!DOCTYPE html>
<html  ><head>
  	<!-- Site made with Mobirise Website Builder v4.11.2, https://mobirise.com -->
  	<meta charset="UTF-8">
  	<meta http-equiv="X-UA-Compatible" content="IE=edge">
  	<meta name="generator" content="Mobirise v4.11.2, mobirise.com">
  	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
  	<meta name="description" content="">
	<meta name="google-signin-client_id" content="664499148646-6irjsskl9ph5eafhihqnb7dsgaf6a47f.apps.googleusercontent.com">
  
  	<title>Julifine | <?= $judul; ?></title>
	
  	<link rel="stylesheet" href="<?= base_url(); ?>/assets/web/assets/mobirise-icons2/mobirise2.css">
  	<link rel="stylesheet" href="<?= base_url(); ?>/assets/web/assets/mobirise-icons/mobirise-icons.css">
  	<link rel="stylesheet" href="<?= base_url(); ?>/assets/bootstrap/css/bootstrap.min.css">
  	<link rel="stylesheet" href="<?= base_url(); ?>/assets/bootstrap/css/bootstrap-grid.min.css">
  	<link rel="stylesheet" href="<?= base_url(); ?>/assets/bootstrap/css/bootstrap-reboot.min.css">
	<link href="https://fonts.googleapis.com/css?family=Saira:300,400,500,600,700,800&display=swap&subset=latin-ext" rel="stylesheet">
  	<link rel="stylesheet" href="<?= base_url(); ?>/assets/dropdown/css/style.css">
  	<link rel="stylesheet" href="<?= base_url(); ?>/assets/tether/tether.min.css">
  	<link rel="stylesheet" href="<?= base_url(); ?>/assets/socicon/css/styles.css">
  	<link rel="stylesheet" href="<?= base_url(); ?>/assets/theme/css/style.css">
  	<link rel="stylesheet" href="<?= base_url(); ?>/assets/gallery/style.css">
  	<link rel="preload" as="style" href="<?= base_url(); ?>/assets/mobirise/css/mbr-additional.css">
	<link rel="stylesheet" href="<?= base_url(); ?>/assets/mobirise/css/mbr-additional.css" type="text/css">
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
  	<link rel="shortcut icon" href="<?= base_url(); ?>/Assets/logo.png">
	
	<script src="https://kit.fontawesome.com/514d14375d.js"></script>
	<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css" integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">
	<script src="https://cdn.firebase.com/libs/firebaseui/4.2.0/firebaseui.js"></script>
	<link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/4.2.0/firebaseui.css" />
	<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-firestore.js"></script>
	<script src="https://apis.google.com/js/platform.js" async defer></script>
	<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-database.js"></script>
	<script src="https://www.gstatic.com/firebasejs/7.5.0/firebase-storage.js"></script>
	<!--<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">-->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>	
	<script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
	
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@8"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@8.18.6/dist/sweetalert2.all.min.js"></script>
	<!-- Optional: include a polyfill for ES6 Promises for IE11 -->
	<script src="https://cdn.jsdelivr.net/npm/promise-polyfill"></script>
	
	<script>var base_url = '<?php echo base_url(); ?>';</script>
	<script src="<?= base_url(); ?>js/auth.js"></script>
	
	<style>
		.nav-dropdown:hover>.dropdown-menu{
			display: block
		}
		
		.btn-delete-cart:hover{
			cursor: pointer
		}
		
		.btn-hijau{
			background-color: #28A745!important;color: black!important
		}

		.btn-merah{
			background-color: #DC3545!important;color: black!important
		}
	</style>
	
</head>
<body>
	<section class="menu cid-qTkzRZLJNu" once="menu" id="menu1-3">
    	<nav class="navbar navbar-expand beta-menu navbar-dropdown align-items-center navbar-fixed-top navbar-toggleable-sm" style="padding-left: 100px;padding-right: 100px">
        	<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            	<div class="hamburger">
                	<span></span>
                	<span></span>
                	<span></span>
                	<span></span>
           		</div>
        	</button>
        	<div class="menu-logo">
            	<div class="navbar-brand">
                	<span class="navbar-logo">
                    	<a href="javascript:toAnotherPage('<?= base_url();?>')">
                         	<img src="<?= base_url(); ?>/assets/logo-text-landscape.png" alt="Mobirise" title="" style="height: 40px">
                    	</a>
                	</span>
            	</div>
        	</div>
        	<div class="collapse navbar-collapse" id="navbarSupportedContent">
            	<ul class="navbar-nav nav-dropdown nav-right" data-app-modern-menu="true">
					<li class="nav-item">
						<a class="nav-link link text-white" href="javascript:toAnotherPage('<?= base_url();?>Home/BedroomCatalogue')" style="font-weight: bold;font-size: 16px">BEDROOM</a>
					</li>
					<li class="nav-item">
						<a class="nav-link link text-white" href="javascript:toAnotherPage('<?= base_url();?>Home/LivingRoomCatalogue')" style="font-weight: bold;font-size: 16px">LIVINGROOM</a>
					</li>
					<li class="nav-item">
						<a class="nav-link link text-white" href="javascript:toAnotherPage('<?= base_url();?>Home/KitchenCatalogue')" style="font-weight: bold;font-size: 16px">KITCHEN</a>
					</li>
					<li class="nav-item">
						<a class="nav-link link text-white" href="javascript:toAnotherPage('<?= base_url();?>Home/DiningRoomCatalogue')" style="font-weight: bold;font-size: 16px">DININGROOM</a>
					</li>
					<li class="nav-item">
						<a class="nav-link link text-white" href="javascript:toAnotherPage('<?= base_url();?>Home/WorkRoomCatalogue')" style="font-weight: bold;font-size: 16px">WORKROOM</a>
					</li>
					<li class="nav-item">
						<a class="nav-link link text-white" href="javascript:toAnotherPage('<?= base_url();?>Home/BathRoomCatalogue')" style="font-weight: bold;font-size: 16px">BATHROOM</a>
					</li>
					<li class="nav-item">
						<a class="nav-link link text-white" href="javascript:toAnotherPage('<?= base_url();?>Home/KidsRoomCatalogue')" style="font-weight: bold;font-size: 16px">KIDSROOM</a>
					</li>
					<li class="nav-item">
						<a class="nav-link link text-white" href="javascript:toAnotherPage('<?= base_url();?>Home/OutdoorCatalogue')" style="font-weight: bold;font-size: 16px">OUTDOOR</a>
					</li>
				</ul>
				<form class="form-inline ml-auto" style="">
			  		<input class="form-control-sm mr-sm-2 search-nav" type="search" placeholder="Search" aria-label="Search" style="background-color: transparent;border: 2px white solid;border-radius: 10px;color: white;height: 40px">
			  		<button class="btn-search" type="submit" style="margin-left: -50px;background-color: transparent;border: none"><div class="fas fa-search" style="color: white"></div></button>
				</form>
				<ul class="navbar-nav ml-4">
					<li class="nav-item nav-dropdown" id="cart">
						<a class="nav-link" href="#" id="navbardrop" data-toggle="dropdown">
							<span class="mbri-shopping-cart mbr-iconfont mbr-iconfont-btn" style="color: rgb(255, 255, 255);font-size: 30px"></span>
						</a>
						<div class="dropdown-menu" style="right: 0%x;left: 70.5%;width: 25%">
							<div class="container">
								<div class="col-12">
									<span style="font-size: 18px;font-weight: normal">MY CART</span>
								</div>
								<div class="col-12">
									<div class="dropdown-divider" style="border: 0.5px solid #808080;margin-top: 20px"></div>
								</div>
								<div class="col-12" style="text-align: center;padding: 20px" id="cart-empty">
									<span style="font-size: 18px;font-weight: normal">Your Cart is Empty</span>
								</div>
								<div style="">
									<div class="container" id="cart-avail" style="display: none">
									</div>
								</div>
							</div>
						</div>
					</li>
					<li class="nav-item nav-dropdown" id="user-none">
						<a class="nav-link" href="#" id="navbar-xdrop" data-toggle="dropdown">
							<span class="mobi-mbri mobi-mbri-user mbr-iconfont mbr-iconfont-btn" style="color: rgb(255, 255, 255);font-size: 25px"></span>
						</a>
						<div class="dropdown-menu" style="right: 0%x;left: 80%;">
							<a class="drop-item" href="javascript:toAnotherPage('<?= base_url();?>Landing/Login')" style="color: black;">Login</a>
							<a class="drop-item" href="javascript:toAnotherPage('<?= base_url();?>Landing/Register')" style="color: black" >Register</a>
						</div>
					</li>
					<li class="nav-item nav-dropdown" id="user-avail" style="display: none">
						<a class="nav-link" href="#" id="navbar-xdrop" data-toggle="dropdown">
							<img id="profilePicture" src="" alt="" style="height: 32px;border-radius: 20px;">
						</a>
						<div class="dropdown-menu" style="right: 0%x;left: 80%;">
							<a class="drop-item" href="javascript:toAnotherPage('<?= base_url(); ?>MyAccount')" style="color: black;">My Profile</a>
							<a class="drop-item" href="javascript:logout()" style="color: black" >Logout</a>
						</div>
					</li>
				</ul>
        	</div>
    	</nav>
	</section>
	<script>
		function toAnotherPage(base_url){
			window.location = base_url;
		}		
		
		firebase.auth().onAuthStateChanged(function(user){
				if	(user){
					var email = user.email;
					var dn = user.displayName;
					var UID = user.uid;
					var pp = user.photoURL;
					var phoneNumber = user.phoneNumber;
					firebase.database().ref("users").once('value', function(snapshot) {
						snapshot.forEach(function(childSnapshot) {
							var childKey = childSnapshot.key;
							var childData = childSnapshot.val();
							if (UID == childKey){
								if (childData.type == "admin"){
									document.getElementById("cart").style.display = "none";
								}else{
									document.getElementById("cart").style.display = "block";
									firebase.database().ref("users/"+UID+"/Cart").once('value', function(snapshot) {
										var child = [];
										var key = [];
										snapshot.forEach(function(childSnapshot) {
											var childKey = childSnapshot.key;
											var childData = childSnapshot.val();
											child.push(childData);
											key.push(childKey);
										});
										if(child.length != 0){
											document.getElementById("cart-empty").style.display = "none";
											document.getElementById("cart-avail").style.display = "block";
											var totalPrice = 0;
											const formatter = new Intl.NumberFormat('en-US', {
											  style: 'currency',
											  currency: 'IDR',
											  minimumFractionDigits: 0
											});
											for (var i = 0; i < child.length;i++){
												var divRow = document.createElement("div");
												document.getElementById("cart-avail").appendChild(divRow);
												divRow.className = "row";
												divRow.style.marginTop = "10px";

												var divColImage = document.createElement("div");
												divRow.appendChild(divColImage);
												divColImage.className = "col-1";

												var prodImage = document.createElement("img");
												divColImage.appendChild(prodImage);
												prodImage.src = child[i].productImage;
												prodImage.style.borderRadius = "50px";
												prodImage.setAttribute('width', "50");
												prodImage.setAttribute('height', "50");

												var divColName = document.createElement("div");
												divRow.appendChild(divColName);
												divColName.className = "col-5 ml-5";

												var prodName = document.createElement("span");
												divColName.appendChild(prodName);
												prodName.innerHTML = child[i].productName+"<br>";

												var prodQTY = document.createElement("span");
												divColName.appendChild(prodQTY);
												prodQTY.innerHTML = "QTY: " + child[i].qty;

												var divColPrice = document.createElement("div");
												divRow.appendChild(divColPrice);
												divColPrice.className = "col-5";
												divColPrice.style.marginLeft = "-50px";
												var priced = formatter.format(child[i].totalPrice);

												var prodPrice = document.createElement("span");
												divColPrice.appendChild(prodPrice);
												prodPrice.innerHTML = priced;
												totalPrice = totalPrice + child[i].totalPrice;

												var divColDelete = document.createElement("div");
												divRow.appendChild(divColDelete);
												divColDelete.className = "col-1";
												divColDelete.style.marginLeft = "-20px";

												var prodDelete = document.createElement("button");
												divColDelete.appendChild(prodDelete);
												prodDelete.style.backgroundColor = "transparent";
												prodDelete.style.border = "none";
												prodDelete.className = "fas fa-trash-alt btn-delete-cart";
												prodDelete.id = "btn_delete_cart_"+i;
												prodDelete.style.width = "20px";
												prodDelete.style.height = "20px";
												prodDelete.style.marginTop = "20px";
												prodDelete.onclick = "deleteItem()";
												prodDelete.dataset.tags = child[i].productName;
												
												var btn_delete_item = document.getElementById("btn_delete_cart_"+i);
												btn_delete_item.onclick = function(){
													
													const swalWithBootstrapButtons = Swal.mixin({
													  customClass: {
														confirmButton: 'btn btn-hijau',
														cancelButton: 'btn btn-merah'
													  },
													  buttonsStyling: false
													})

													swalWithBootstrapButtons.fire({
													  title: 'Warning!',
													  text: "Are you sure want to remove this item?",
													  type: 'warning',
													  showCancelButton: true,
													  confirmButtonText: 'Yes, delete it',
													  cancelButtonText: 'No, cancel',
													  reverseButtons: true
													}).then((result) => {
													  if (result.dismiss === Swal.DismissReason.cancel) {
														swalWithBootstrapButtons.fire(
														  'Cancelled',
														  'The item successfully added back to your cart!',
														  'error'
														)
													  }else if (result.dismiss){
														  swalWithBootstrapButtons.fire(
															  'Cancelled',
															  'The item successfully added back to your cart!',
															  'error'
														  );
													  }else{
														  swalWithBootstrapButtons.fire(
															  'Success',
															  'The item successfully removed from your cart!',
															  'success'
														  ).then((result) =>{
															  if (result.dismiss){
																  deleteItem(UID,this.dataset.tags);
															  }else{
																  deleteItem(UID,this.dataset.tags);
															  }
														  });
													  }
													});													
												}
											}
											
											var divContainer = document.createElement("div");
											divRow.appendChild(divContainer);
											divContainer.className = "container";
											
											var divRowTotalPrice = document.createElement("div");
											divContainer.appendChild(divRowTotalPrice);
											divRowTotalPrice.className = "row";
											divRowTotalPrice.style.backgroundColor = "rgba(0,0,0,0.3)";
											divRowTotalPrice.style.marginTop = "20px";

											var divTotalName = document.createElement("div");
											divRowTotalPrice.appendChild(divTotalName);
											divTotalName.className = "col-4";

											var totalCartName = document.createElement("a");
											divTotalName.appendChild(totalCartName);
											totalCartName.innerHTML = "View Detail";
											totalCartName.style.color = "black"
											totalCartName.href = "<?= base_url();?>Home/Cart"

											var divTotalPrice = document.createElement("div");
											divRowTotalPrice.appendChild(divTotalPrice);
											divTotalPrice.className = "col-8";
											divTotalPrice.style.textAlign = "right";

											var totalCartPrice = document.createElement("span");
											divTotalPrice.appendChild(totalCartPrice);
											totalCartPrice.innerHTML = "Total Price: <b>"+formatter.format(totalPrice)+"</b>";
										}else{
											document.getElementById("cart-empty").style.display = "block";
											document.getElementById("cart-avail").style.display = "none";
										}
									});
								}
								document.getElementById('profilePicture').src = childData.imageUrl;
							} 
						});
					});
					document.getElementById("user-none").style.display = "none";
					document.getElementById("user-avail").style.display = "block";
				}else{
					document.getElementById("user-none").style.display = "block";
					document.getElementById("user-avail").style.display = "none";
				}
			});
		
		function deleteItem(UID,datasetTags){
			var cartItem = firebase.database().ref("users/"+UID+"/Cart");
			var prodctName = datasetTags;
			cartItem.once('value',function(snapshot) {
				var chldData = [];
				var chldKey = [];
				snapshot.forEach(function(childSnapshot) {
					var childKey = childSnapshot.key;
					var childData = childSnapshot.val();
					chldData.push(childData);
					chldKey.push(childKey);
				});
				console.log(chldData);
				for(var i = 0; i < chldKey.length;i++){
					if(chldKey[i] == prodctName){
						cartItem.child(prodctName).remove();
						var qtyInCart = chldData[i].qty;
						var prodctRef = firebase.database().ref("products/"+chldData[i].roomCategory+"/"+chldData[i].productCategory+"/"+chldData[i].productName);
						prodctRef.once('value',function(snapshot){
							var productDetail = [];
							snapshot.forEach(function(childSnapshot){
								var childKey = childSnapshot.key;
								var childData = childSnapshot.val();
								productDetail.push(childData);
							});
							console.log(productDetail);
							var newStock = parseInt(productDetail[6])+parseInt(qtyInCart);
							prodctRef.update({
								stock:newStock
							}, function(error) {
								if (error) {
								  // The write failed...
								} else {
								  // Data saved successfully!
									//alert('Success Delete an Item in Cart6!');

									document.location.reload(true);
								}
							});
						});
					}
				}
			});
		}
		
	</script>